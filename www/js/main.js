!function(a){function b(a){return o*p/a}function c(a,b){var c=[],d=0,e=q.call(arguments,2);for(d=0;a>d;d++)c.push(b.apply(null,e));return c}function d(a,b){var c=q.call(arguments,2);return a.map(function(a){return a[b].apply(a,c)})}function e(){this.el=n.createElement("span"),this.el.classList.add("sequencer-square");var a=!1;this.activate=function(){this.el.classList.add("sequencer-square-active")},this.deactivate=function(){this.el.classList.remove("sequencer-square-active")},this.toggle=function(){this.el.classList.toggle("sequencer-square-toggle"),a=!a}.bind(this),this.toggled=function(){return a},this.bindEvents=function(){this.el.addEventListener("click",this.toggle,!1)}}function f(a){return 10>a?"0"+String(a):String(a)}function g(){return(new Date).getTime()}function h(a,b){function f(){if(h){var a=b.createBufferSource();a.buffer=h,a.connect(b.destination),a.noteOn(0)}}this.el=n.createElement("div");var g,h,i=[],j=n.createElement("input");j.type="file",i=c(a,e.create),i.forEach(function(a){this.el.appendChild(a.el)}.bind(this)),this.el.appendChild(j),this.bindEvents=function(){d(i,"bindEvents"),j.addEventListener("change",function(){l(j.files[0],b,function(a){h=a})})},this.setActive=function(a){g&&g.deactivate(),g=i[a],g&&(g.activate(),g.toggled()&&f())},this.clearActive=function(){g&&g.classList.remove("sequencer-square-active"),g=void 0}}function i(e){function i(){m=0,d(t,"setActive"),j()}function j(){o.innerHTML=f(Math.floor(m/4)+1)+" - "+f(m%4+1)}function k(){t.forEach(function(a){a.setActive(m)}),j.call(this),m=(m+1)%r}this.el=n.createElement("div");var l,m,o=n.createElement("span"),p=108,q=new webkitAudioContext,r=16,s=function(){var c=g(),d=b(4*p);k.call(this),l=a.setTimeout(s,Math.floor(d-(g()-c)))}.bind(this),t=c(e,h.create,r,q);this.el.appendChild(o),t.forEach(function(a){this.el.appendChild(a.el)}.bind(this)),this.bindEvents=function(){d(t,"bindEvents")},this.setTempo=function(a){p=a},this.start=function(){this.stop(),s()},this.stop=function(){i(),l&&a.clearTimeout(l)}}function j(a,b){return a.target.classList.contains(b)}function k(a,b){var c=new FileReader;c.onload=function(){b(c.result)},c.readAsArrayBuffer(a)}function l(a,b,c){k(a,function(a){b.decodeAudioData(a,c)})}function m(a,b){this.el=a,this.bindEvents=function(){this.el.addEventListener("click",function(a){j(a,"js-play")?b.start():j(a,"js-stop")&&b.stop()}),this.el.addEventListener("change",function(a){j(a,"js-tempo")&&b.setTempo(parseInt(a.target.value,10))})}}var n=a.document,o=1e3,p=60,q=Array.prototype.slice;e.create=function(){return new e},h.create=function(a,b){return new h(a,b)};var r=new i(3),s=new m(n.getElementById("controls"),r);n.getElementById("main").appendChild(r.el),r.bindEvents(),s.bindEvents()}(this);